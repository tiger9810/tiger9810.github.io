# Next.jsã¨Twitter API v2ã§ä½œã‚‹è‡ªåˆ†å°‚ç”¨ã®XæŠ•ç¨¿ã‚¢ãƒ—ãƒªã€ç¬¬3éƒ¨ï¼šæŠ•ç¨¿ãƒ»å‰Šé™¤ç·¨ã€‘ã¤ã„ã«å®Œæˆï¼ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ãƒ»å‰Šé™¤ã—ã‚ˆã†

<!--
date = "2025-11-26"
-->

## ç¬¬3éƒ¨ã¸ã‚ˆã†ã“ãï¼å®Œæˆã¾ã§ã‚ã¨å°‘ã—ï¼

ç¬¬2éƒ¨ã§è‡ªåˆ†ã®ãƒ„ã‚¤ãƒ¼ãƒˆãŒç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã­ã€‚ç´ æ™´ã‚‰ã—ã„ï¼

ã§ã‚‚ã€ã€Œè¦‹ã‚‹ã ã‘ã˜ã‚ƒã¤ã¾ã‚‰ãªã„...æŠ•ç¨¿ã‚‚ã—ãŸã„ï¼ã€ã¨æ€ã£ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

**å®‰å¿ƒã—ã¦ãã ã•ã„ã€‚ã“ã®ç¬¬3éƒ¨ã§ã€ã¤ã„ã«ã‚¢ãƒ—ãƒªãŒå®Œæˆã—ã¾ã™ã€‚**

## ã“ã®ç¬¬3éƒ¨ã®ã‚´ãƒ¼ãƒ«

**ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ãƒ»å‰Šé™¤ã§ãã‚‹å®Œå…¨ãªTwitterã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã®å®Œæˆ**

ã“ã®ç¬¬3éƒ¨ã‚’çµ‚ãˆã‚‹ã¨ï¼š

âœ… ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å…¥åŠ›ã—ã¦æŠ•ç¨¿ã§ãã‚‹  
âœ… æŠ•ç¨¿å‰ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèªã§ãã‚‹  
âœ… è‡ªåˆ†ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å‰Šé™¤ã§ãã‚‹  
âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç”»é¢ãŒæ›´æ–°ã•ã‚Œã‚‹

---

## 3éƒ¨ä½œã®é€²æ—çŠ¶æ³

- âœ… **ç¬¬1éƒ¨ï¼ˆå®Œäº†ï¼‰ï¼š** ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
- âœ… **ç¬¬2éƒ¨ï¼ˆå®Œäº†ï¼‰ï¼š** ãƒ„ã‚¤ãƒ¼ãƒˆè¡¨ç¤ºæ©Ÿèƒ½
- ğŸ”¥ **ç¬¬3éƒ¨ï¼ˆä»Šå›ï¼‰ï¼š** ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿ãƒ»å‰Šé™¤æ©Ÿèƒ½ â† **å®Œæˆï¼**

---

## ç›®æ¬¡

1. [ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿ã®ä»•çµ„ã¿](#1-ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿ã®ä»•çµ„ã¿)
2. [ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿APIã‚’ä½œæˆã™ã‚‹](#2-ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿apiã‚’ä½œæˆã™ã‚‹)
3. [ãƒ„ã‚¤ãƒ¼ãƒˆå‰Šé™¤APIã‚’ä½œæˆã™ã‚‹](#3-ãƒ„ã‚¤ãƒ¼ãƒˆå‰Šé™¤apiã‚’ä½œæˆã™ã‚‹)
4. [APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹](#4-apiã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹)
5. [UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹](#5-uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹)
6. [å‹•ä½œç¢ºèª](#6-å‹•ä½œç¢ºèª)
7. [ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•](#7-ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•)
8. [ã•ã‚‰ã«æ”¹å–„ã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢](#8-ã•ã‚‰ã«æ”¹å–„ã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢)

---

## 1. ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿ã®ä»•çµ„ã¿

### 1-1. Twitter APIã§ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã™ã‚‹

Twitter API v2ã§ã¯ã€ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã—ã¾ã™ï¼š
```
POST https://api.twitter.com/2/tweets
```

ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ï¼š
```json
{
  "text": "æŠ•ç¨¿ã™ã‚‹ãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡"
}
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**

- ãƒ„ã‚¤ãƒ¼ãƒˆã¯280æ–‡å­—ä»¥å†…
- `tweet.write`ã‚¹ã‚³ãƒ¼ãƒ—ãŒå¿…è¦ï¼ˆç¬¬1éƒ¨ã§è¨­å®šæ¸ˆã¿ï¼‰
- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦

### 1-2. ãƒ„ã‚¤ãƒ¼ãƒˆå‰Šé™¤ã®ä»•çµ„ã¿

ãƒ„ã‚¤ãƒ¼ãƒˆå‰Šé™¤ã¯ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ã„ã¾ã™ï¼š
```
DELETE https://api.twitter.com/2/tweets/{tweet_id}
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**

- è‡ªåˆ†ã®ãƒ„ã‚¤ãƒ¼ãƒˆã®ã¿å‰Šé™¤å¯èƒ½
- å‰Šé™¤ã—ãŸãƒ„ã‚¤ãƒ¼ãƒˆã¯å¾©å…ƒã§ããªã„

### 1-3. å®Ÿè£…ã®æµã‚Œ
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«å…¥åŠ›
2. ã€ŒæŠ•ç¨¿ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§ç¢ºèª
4. ã€ŒæŠ•ç¨¿ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. Next.js APIãƒ«ãƒ¼ãƒˆ â†’ Twitter API
6. æˆåŠŸã—ãŸã‚‰ç”»é¢ã‚’æ›´æ–°
```

---

## 2. ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿APIã‚’ä½œæˆã™ã‚‹

### 2-1. å‹å®šç¾©ã‚’è¿½åŠ 

ã¾ãšã€`types/tweet.ts`ã«ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿ã®å‹ã‚’è¿½åŠ ã—ã¾ã™ï¼š

`types/tweet.ts`ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
```typescript
export interface CreateTweetRequest {
    text: string;
}

export interface CreateTweetResponse {
    data: {
        id: string;
        text: string;
    };
}

export interface DeleteTweetResponse {
    data: {
        deleted: boolean;
    };
}
```

### 2-2. ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿APIãƒ«ãƒ¼ãƒˆã‚’ä½œæˆ

ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆï¼š
```bash
mkdir -p app/api/twitter/create
```

`app/api/twitter/create/route.ts`:
```typescript
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";

const TWITTER_API_BASE = "https://api.twitter.com/2";

export async function POST(request: NextRequest) {
    try {
        const session = await getServerSession(authOptions);

        console.log("Session in /api/twitter/create:", {
            hasSession: !!session,
            hasAccessToken: !!session?.accessToken,
        });

        if (!session?.accessToken) {
            console.error("No access token in session");
            return NextResponse.json(
                { error: "Unauthorized" },
                { status: 401 }
            );
        }

        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’å–å¾—
        const body = await request.json();
        const { text } = body;

        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        if (!text || !text.trim()) {
            return NextResponse.json(
                { error: "Tweet text is required" },
                { status: 400 }
            );
        }

        if (text.length > 280) {
            return NextResponse.json(
                { error: "Tweet text must be 280 characters or less" },
                { status: 400 }
            );
        }

        const url = `${TWITTER_API_BASE}/tweets`;

        console.log("Creating tweet:", {
            url,
            textLength: text.length,
        });

        // Twitter APIã‚’å‘¼ã³å‡ºã™
        const response = await fetch(url, {
            method: "POST",
            headers: {
                Authorization: `Bearer ${session.accessToken}`,
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ text }),
        });

        console.log("Twitter API response:", {
            status: response.status,
            statusText: response.statusText,
            ok: response.ok,
        });

        if (!response.ok) {
            const error = await response.json();
            console.error("Twitter API error response:", JSON.stringify(error, null, 2));
            return NextResponse.json(
                { error: error.detail || error.title || "Failed to create tweet" },
                { status: response.status }
            );
        }

        const data = await response.json();
        return NextResponse.json(data);
    } catch (error) {
        console.error("Error in /api/twitter/create:", error);
        return NextResponse.json(
            { error: "Internal server error" },
            { status: 500 }
        );
    }
}
```

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜ï¼š**

#### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
```typescript
if (!text || !text.trim()) {
    return NextResponse.json(
        { error: "Tweet text is required" },
        { status: 400 }
    );
}

if (text.length > 280) {
    return NextResponse.json(
        { error: "Tweet text must be 280 characters or less" },
        { status: 400 }
    );
}
```

**ãªãœãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¿…è¦ï¼Ÿ**

- ç©ºã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã§ããªã„ã‚ˆã†ã«ã™ã‚‹
- 280æ–‡å­—åˆ¶é™ã‚’å®ˆã‚‹
- Twitter APIã«ç„¡é§„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‰ãªã„

#### Twitter APIã‚’å‘¼ã³å‡ºã™
```typescript
const response = await fetch(url, {
    method: "POST",
    headers: {
        Authorization: `Bearer ${session.accessToken}`,
        "Content-Type": "application/json",
    },
    body: JSON.stringify({ text }),
});
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**

- `method: "POST"`ï¼šPOSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- `Authorization`ï¼šã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å«ã‚ã‚‹
- `body`ï¼šãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡ã‚’JSONå½¢å¼ã§é€ã‚‹

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```typescript
if (!response.ok) {
    const error = await response.json();
    console.error("Twitter API error response:", JSON.stringify(error, null, 2));
    return NextResponse.json(
        { error: error.detail || error.title || "Failed to create tweet" },
        { status: response.status }
    );
}
```

Twitter APIã‹ã‚‰ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚ŒãŸå ´åˆã€è©³ç´°ãªãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€403 Forbiddenãªã©ã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒ‡ãƒãƒƒã‚°ã§ãã¾ã™ã€‚

---

## 3. ãƒ„ã‚¤ãƒ¼ãƒˆå‰Šé™¤APIã‚’ä½œæˆã™ã‚‹

### 3-1. ãƒ„ã‚¤ãƒ¼ãƒˆå‰Šé™¤APIãƒ«ãƒ¼ãƒˆã‚’ä½œæˆ

ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆï¼š
```bash
mkdir -p app/api/twitter/delete/\[id\]
```

**Windowsã®å ´åˆï¼š**

ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã§æ‰‹å‹•ã§ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆï¼š
```
app â†’ api â†’ twitter â†’ delete â†’ [id]
```

`app/api/twitter/delete/[id]/route.ts`:
```typescript
import { NextRequest, NextResponse } from "next/server";
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";

const TWITTER_API_BASE = "https://api.twitter.com/2";

export async function DELETE(
    request: NextRequest,
    { params }: { params: { id: string } }
) {
    try {
        const session = await getServerSession(authOptions);

        if (!session?.accessToken) {
            return NextResponse.json(
                { error: "Unauthorized" },
                { status: 401 }
            );
        }

        const tweetId = params.id;

        if (!tweetId) {
            return NextResponse.json(
                { error: "Tweet ID is required" },
                { status: 400 }
            );
        }

        const url = `${TWITTER_API_BASE}/tweets/${tweetId}`;

        console.log("Deleting tweet:", {
            url,
            tweetId,
        });

        // Twitter APIã‚’å‘¼ã³å‡ºã™
        const response = await fetch(url, {
            method: "DELETE",
            headers: {
                Authorization: `Bearer ${session.accessToken}`,
                "Content-Type": "application/json",
            },
        });

        console.log("Twitter API response:", {
            status: response.status,
            statusText: response.statusText,
            ok: response.ok,
        });

        if (!response.ok) {
            const error = await response.json();
            console.error("Twitter API error response:", error);
            return NextResponse.json(
                { error: error.detail || error.title || "Failed to delete tweet" },
                { status: response.status }
            );
        }

        const data = await response.json();
        return NextResponse.json(data);
    } catch (error) {
        console.error("Error in /api/twitter/delete:", error);
        return NextResponse.json(
            { error: "Internal server error" },
            { status: 500 }
        );
    }
}
```

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜ï¼š**

#### å‹•çš„ãƒ«ãƒ¼ãƒˆ
```typescript
export async function DELETE(
    request: NextRequest,
    { params }: { params: { id: string } }
) {
    const tweetId = params.id;
}
```

**`[id]`ãƒ•ã‚©ãƒ«ãƒ€ã®æ„å‘³ï¼š**

- `/api/twitter/delete/123456789`ã¨ã„ã†URLã«ã‚¢ã‚¯ã‚»ã‚¹
- `params.id`ã§`123456789`ã‚’å–å¾—ã§ãã‚‹

ã“ã‚Œã«ã‚ˆã‚Šã€ã©ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å‰Šé™¤ã™ã‚‹ã‹ã‚’URLã§æŒ‡å®šã§ãã¾ã™ã€‚

#### DELETEãƒªã‚¯ã‚¨ã‚¹ãƒˆ
```typescript
const response = await fetch(url, {
    method: "DELETE",
    headers: {
        Authorization: `Bearer ${session.accessToken}`,
        "Content-Type": "application/json",
    },
});
```

POSTã®ä»£ã‚ã‚Šã«DELETEãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„ã¾ã™ã€‚

---

## 4. APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹

### 4-1. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´APIé–¢æ•°ã‚’è¿½åŠ 

`lib/twitter-api.ts`ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
```typescript
/**
 * ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿
 */
export async function createTweet(
    text: string
): Promise<CreateTweetResponse> {
    try {
        const url = `/api/twitter/create`;

        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ text }),
        });

        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || 'Failed to create tweet');
        }

        return await response.json();
    } catch (error) {
        console.error('Error creating tweet:', error);
        throw error;
    }
}

/**
 * ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å‰Šé™¤
 */
export async function deleteTweet(
    tweetId: string
): Promise<boolean> {
    try {
        const url = `/api/twitter/delete/${tweetId}`;

        const response = await fetch(url, {
            method: 'DELETE',
        });

        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || 'Failed to delete tweet');
        }

        const data: DeleteTweetResponse = await response.json();
        return data.data.deleted;
    } catch (error) {
        console.error('Error deleting tweet:', error);
        throw error;
    }
}
```

**ã“ã‚Œã¯ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ**

ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰è‡ªåˆ†ã®APIãƒ«ãƒ¼ãƒˆï¼ˆ`/api/twitter/create`ãªã©ï¼‰ã‚’å‘¼ã³å‡ºã™é–¢æ•°ã§ã™ã€‚

---

## 5. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹

### 5-1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’è¿½åŠ 

`lib/utils.ts`ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
```typescript
/**
 * ãƒ„ã‚¤ãƒ¼ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
 */
export interface TweetValidation {
    isValid: boolean;
    error?: string;
}

export function validateTweetText(text: string): TweetValidation {
    if (!text || !text.trim()) {
        return {
            isValid: false,
            error: "ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
        };
    }

    if (text.length > 280) {
        return {
            isValid: false,
            error: "ãƒ„ã‚¤ãƒ¼ãƒˆã¯280æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"
        };
    }

    return { isValid: true };
}
```

### 5-2. ãƒ„ã‚¤ãƒ¼ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

`components/TweetPreview.tsx`:
```typescript
"use client";

interface TweetPreviewProps {
    text: string;
    onConfirm: () => void;
    onCancel: () => void;
    isPosting: boolean;
}

export default function TweetPreview({
    text,
    onConfirm,
    onCancel,
    isPosting,
}: TweetPreviewProps) {
    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 className="text-lg font-semibold mb-4">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                
                <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4">
                    <p className="whitespace-pre-wrap break-words text-gray-900">
                        {text}
                    </p>
                </div>

                <div className="flex gap-3 justify-end">
                    <button
                        onClick={onCancel}
                        disabled={isPosting}
                        className="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50"
                    >
                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </button>
                    <button
                        onClick={onConfirm}
                        disabled={isPosting}
                        className="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50"
                    >
                        {isPosting ? "æŠ•ç¨¿ä¸­..." : "æŠ•ç¨¿ã™ã‚‹"}
                    </button>
                </div>
            </div>
        </div>
    );
}
```

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜ï¼š**

- **ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º**ï¼š`fixed inset-0`ã§ç”»é¢å…¨ä½“ã‚’è¦†ã†
- **èƒŒæ™¯ã®æš—è»¢**ï¼š`bg-black bg-opacity-50`ã§åŠé€æ˜ã®é»’èƒŒæ™¯
- **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæŠ•ç¨¿ã™ã‚‹å†…å®¹ã‚’ç¢ºèªã§ãã‚‹
- **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹**ï¼šæŠ•ç¨¿ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–

### 5-3. ãƒ„ã‚¤ãƒ¼ãƒˆä½œæˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

`components/TweetComposer.tsx`:
```typescript
"use client";

import { useState } from "react";
import { validateTweetText } from "@/lib/utils";
import TweetPreview from "./TweetPreview";

interface TweetComposerProps {
    onTweetCreated: () => void;
    onCreateTweet: (text: string) => Promise<void>;
}

export default function TweetComposer({
    onTweetCreated,
    onCreateTweet,
}: TweetComposerProps) {
    const [text, setText] = useState("");
    const [showPreview, setShowPreview] = useState(false);
    const [isPosting, setIsPosting] = useState(false);
    const [error, setError] = useState<string | null>(null);

    const characterCount = text.length;
    const remainingCharacters = 280 - characterCount;

    const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault();

        const validation = validateTweetText(text);
        if (!validation.isValid) {
            setError(validation.error || null);
            return;
        }

        setError(null);
        setShowPreview(true);
    };

    const handleConfirmPost = async () => {
        setIsPosting(true);
        setError(null);

        try {
            await onCreateTweet(text);
            setText("");
            setShowPreview(false);
            onTweetCreated();
        } catch (err) {
            setError(err instanceof Error ? err.message : "æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ");
            setShowPreview(false);
        } finally {
            setIsPosting(false);
        }
    };

    const handleCancelPreview = () => {
        setShowPreview(false);
    };

    return (
        <>
            <div className="border border-gray-200 rounded-lg p-4 bg-white">
                <form onSubmit={handleSubmit} className="space-y-3">
                    <textarea
                        value={text}
                        onChange={(e) => setText(e.target.value)}
                        placeholder="ä»Šä½•ã—ã¦ã‚‹?"
                        className="w-full min-h-[120px] p-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        disabled={isPosting}
                    />

                    {error && (
                        <p className="text-sm text-red-500">{error}</p>
                    )}

                    <div className="flex items-center justify-between">
                        <span
                            className={`text-sm ${
                                remainingCharacters < 0
                                    ? "text-red-500 font-bold"
                                    : remainingCharacters < 20
                                        ? "text-orange-500"
                                        : "text-gray-500"
                            }`}
                        >
                            {remainingCharacters < 0 && "-"}
                            {Math.abs(remainingCharacters)} / 280
                        </span>

                        <button
                            type="submit"
                            disabled={!text.trim() || remainingCharacters < 0 || isPosting}
                            className="px-6 py-2 bg-blue-500 text-white font-medium rounded-full hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            æŠ•ç¨¿ã™ã‚‹
                        </button>
                    </div>
                </form>
            </div>

            {showPreview && (
                <TweetPreview
                    text={text}
                    onConfirm={handleConfirmPost}
                    onCancel={handleCancelPreview}
                    isPosting={isPosting}
                />
            )}
        </>
    );
}
```

**ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜ï¼š**

#### æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
```typescript
const characterCount = text.length;
const remainingCharacters = 280 - characterCount;
```

ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ®‹ã‚Šæ–‡å­—æ•°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

#### è‰²åˆ†ã‘
```typescript
className={`text-sm ${
    remainingCharacters < 0
        ? "text-red-500 font-bold"      // è¶…éï¼šèµ¤è‰²
        : remainingCharacters < 20
            ? "text-orange-500"          // 20æ–‡å­—ä»¥ä¸‹ï¼šã‚ªãƒ¬ãƒ³ã‚¸
            : "text-gray-500"            // é€šå¸¸ï¼šã‚°ãƒ¬ãƒ¼
}`}
```

æ®‹ã‚Šæ–‡å­—æ•°ã«å¿œã˜ã¦è‰²ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚

#### æŠ•ç¨¿ã®æµã‚Œ

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ŒæŠ•ç¨¿ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. `handleSubmit`ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
3. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
4. ã€ŒæŠ•ç¨¿ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. `handleConfirmPost`ã§å®Ÿéš›ã«æŠ•ç¨¿
6. æˆåŠŸã—ãŸã‚‰`onTweetCreated`ã‚’å‘¼ã¶ï¼ˆç”»é¢ã‚’æ›´æ–°ï¼‰

### 5-4. ãƒ„ã‚¤ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã«å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 

`components/TweetItem.tsx`ã‚’æ›´æ–°ï¼š
```typescript
"use client";

import { Tweet } from "@/types/tweet";
import { formatDate } from "@/lib/utils";

interface TweetItemProps {
    tweet: Tweet;
    username: string;
    onDelete?: (tweetId: string) => void;
    isDeleting?: boolean;
}

export default function TweetItem({ 
    tweet, 
    username, 
    onDelete,
    isDeleting = false,
}: TweetItemProps) {
    return (
        <div className="border-b border-gray-200 p-4 hover:bg-gray-50 transition-colors">
            <div className="flex items-start gap-3">
                {/* ã‚¢ã‚¤ã‚³ãƒ³ */}
                <div className="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">
                    {username.charAt(0).toUpperCase()}
                </div>

                {/* ãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡ */}
                <div className="flex-1 min-w-0">
                    {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨æ—¥æ™‚ */}
                    <div className="flex items-center justify-between mb-1">
                        <div className="flex items-center gap-2">
                            <span className="font-semibold text-gray-900">
                                @{username}
                            </span>
                            <span className="text-sm text-gray-500">
                                {formatDate(tweet.created_at)}
                            </span>
                        </div>

                        {/* å‰Šé™¤ãƒœã‚¿ãƒ³ */}
                        {onDelete && (
                            <button
                                onClick={() => onDelete(tweet.id)}
                                disabled={isDeleting}
                                className="text-sm text-red-500 hover:text-red-600 disabled:opacity-50"
                            >
                                {isDeleting ? "å‰Šé™¤ä¸­..." : "ğŸ—‘ï¸ å‰Šé™¤"}
                            </button>
                        )}
                    </div>

                    {/* ãƒ„ã‚¤ãƒ¼ãƒˆæœ¬æ–‡ */}
                    <p className="text-gray-900 whitespace-pre-wrap break-words">
                        {tweet.text}
                    </p>

                    {/* ã„ã„ã­æ•°ã€ãƒªãƒ„ã‚¤ãƒ¼ãƒˆæ•° */}
                    <div className="flex items-center gap-4 mt-2 text-sm text-gray-500">
                        <span>ğŸ’¬ {tweet.public_metrics.reply_count}</span>
                        <span>ğŸ” {tweet.public_metrics.retweet_count}</span>
                        <span>â¤ï¸ {tweet.public_metrics.like_count}</span>
                    </div>
                </div>
            </div>
        </div>
    );
}
```

**è¿½åŠ ã—ãŸæ©Ÿèƒ½ï¼š**

- `onDelete`ãƒ—ãƒ­ãƒƒãƒ—ï¼šå‰Šé™¤ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã«å‘¼ã°ã‚Œã‚‹
- `isDeleting`ãƒ—ãƒ­ãƒƒãƒ—ï¼šå‰Šé™¤ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
- å‰Šé™¤ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºï¼š`onDelete`ãŒæ¸¡ã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿è¡¨ç¤º

### 5-5. ãƒ„ã‚¤ãƒ¼ãƒˆä¸€è¦§ã‚’æ›´æ–°

`components/TweetList.tsx`ã‚’æ›´æ–°ï¼š
```typescript
"use client";

import { Tweet } from "@/types/tweet";
import TweetItem from "./TweetItem";

interface TweetListProps {
    tweets: Tweet[];
    username: string;
    isLoading: boolean;
    isRefreshing: boolean;
    onRefresh: () => void;
    onDelete?: (tweetId: string) => void;
    deletingTweetId?: string;
}

export default function TweetList({
    tweets,
    username,
    isLoading,
    isRefreshing,
    onRefresh,
    onDelete,
    deletingTweetId,
}: TweetListProps) {
    if (isLoading) {
        return (
            <div className="bg-white border border-gray-200 rounded-lg p-6">
                <p className="text-center text-gray-500">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        );
    }

    return (
        <div className="bg-white border border-gray-200 rounded-lg overflow-hidden">
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="border-b border-gray-200 p-4 flex items-center justify-between">
                <h2 className="text-lg font-semibold text-gray-900">
                    æœ€è¿‘ã®æŠ•ç¨¿
                </h2>
                <button
                    onClick={onRefresh}
                    disabled={isRefreshing}
                    className="text-sm text-blue-500 hover:text-blue-600 disabled:opacity-50"
                >
                    {isRefreshing ? "æ›´æ–°ä¸­..." : "ğŸ”„ æ›´æ–°"}
                </button>
            </div>

            {/* ãƒ„ã‚¤ãƒ¼ãƒˆä¸€è¦§ */}
            {tweets.length === 0 ? (
                <div className="p-6 text-center text-gray-500">
                    ã¾ã ãƒ„ã‚¤ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“
                </div>
            ) : (
                <div>
                    {tweets.map((tweet) => (
                        <TweetItem
                            key={tweet.id}
                            tweet={tweet}
                            username={username}
                            onDelete={onDelete}
                            isDeleting={deletingTweetId === tweet.id}
                        />
                    ))}
                </div>
            )}
        </div>
    );
}
```

**è¿½åŠ ã—ãŸæ©Ÿèƒ½ï¼š**

- `onDelete`ãƒ—ãƒ­ãƒƒãƒ—ï¼šå‰Šé™¤å‡¦ç†ã‚’è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å§”è­²
- `deletingTweetId`ï¼šç¾åœ¨å‰Šé™¤ä¸­ã®ãƒ„ã‚¤ãƒ¼ãƒˆID

### 5-6. ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°

`app/page.tsx`ã‚’å¤§å¹…ã«æ›´æ–°ã—ã¾ã™ï¼š
```typescript
"use client";

import { useSession, signIn, signOut } from "next-auth/react";
import { useState, useEffect, useCallback } from "react";
import { Tweet } from "@/types/tweet";
import { getUserTweets, getMe, createTweet, deleteTweet } from "@/lib/twitter-api";
import TweetList from "@/components/TweetList";
import TweetComposer from "@/components/TweetComposer";

export default function Home() {
    const { data: session, status } = useSession();
    const [tweets, setTweets] = useState<Tweet[]>([]);
    const [userInfo, setUserInfo] = useState<{ id: string; username: string; name: string } | null>(null);
    const [isLoading, setIsLoading] = useState(true);
    const [isRefreshing, setIsRefreshing] = useState(false);
    const [deletingTweetId, setDeletingTweetId] = useState<string | undefined>();
    const [error, setError] = useState<string | null>(null);

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
    const fetchUserInfo = useCallback(async () => {
        try {
            const info = await getMe();
            setUserInfo(info);
            return info;
        } catch (err) {
            console.error("Failed to fetch user info:", err);
            setError("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
            return null;
        }
    }, []);

    // ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å–å¾—
    const fetchTweets = useCallback(async (userId: string) => {
        try {
            const fetchedTweets = await getUserTweets(userId, 5);
            setTweets(fetchedTweets);
            setError(null);
        } catch (err) {
            console.error("Failed to fetch tweets:", err);
            setError("æŠ•ç¨¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
        } finally {
            setIsLoading(false);
            setIsRefreshing(false);
        }
    }, []);

    // åˆå›ãƒ­ãƒ¼ãƒ‰
    useEffect(() => {
        if (session) {
            const loadData = async () => {
                const info = await fetchUserInfo();
                if (info) {
                    await fetchTweets(info.id);
                }
            };
            loadData();
        } else {
            setIsLoading(false);
        }
    }, [session, fetchUserInfo, fetchTweets]);

    // ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æ›´æ–°
    const handleRefresh = async () => {
        if (!session || !userInfo) return;

        setIsRefreshing(true);
        await fetchTweets(userInfo.id);
    };

    // ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿
    const handleCreateTweet = async (text: string) => {
        if (!session) {
            throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");
        }

        await createTweet(text);
    };

    // ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿å¾Œ
    const handleTweetCreated = () => {
        handleRefresh();
    };

    // ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å‰Šé™¤
    const handleDeleteTweet = async (tweetId: string) => {
        if (!session) return;

        setDeletingTweetId(tweetId);
        try {
            await deleteTweet(tweetId);

            // ãƒ­ãƒ¼ã‚«ãƒ«ã®çŠ¶æ…‹ã‹ã‚‰å‰Šé™¤
            setTweets((prev) => prev.filter((t) => t.id !== tweetId));
            setError(null);
        } catch (err) {
            console.error("Failed to delete tweet:", err);
            setError("æŠ•ç¨¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");
        } finally {
            setDeletingTweetId(undefined);
        }
    };

    if (status === "loading") {
        return (
            <div className="flex min-h-screen items-center justify-center">
                <p className="text-gray-500">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        );
    }

    if (!session) {
        return (
            <div className="flex min-h-screen flex-col items-center justify-center bg-gray-50">
                <div className="space-y-6 text-center">
                    <div className="space-y-2">
                        <h1 className="text-4xl font-bold text-gray-900">X My Posts</h1>
                        <p className="text-gray-600">
                            è‡ªåˆ†ã®æŠ•ç¨¿ã«é›†ä¸­ã§ãã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªXã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
                        </p>
                    </div>
                    <button
                        onClick={() => signIn("twitter")}
                        className="px-6 py-3 bg-blue-500 text-white font-medium rounded-full hover:bg-blue-600 transition-colors"
                    >
                        X (Twitter) ã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
                    </button>
                </div>
            </div>
        );
    }

    return (
        <div className="min-h-screen bg-gray-50">
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <header className="bg-white border-b border-gray-200 sticky top-0 z-10">
                <div className="max-w-2xl mx-auto px-4 py-4 flex items-center justify-between">
                    <h1 className="text-xl font-bold text-gray-900">X My Posts</h1>
                    <div className="flex items-center gap-4">
                        <span className="text-sm text-gray-600">
                            @{userInfo?.username || session.user?.name}
                        </span>
                        <button
                            onClick={() => signOut()}
                            className="text-sm text-gray-600 hover:text-gray-900"
                        >
                            ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ
                        </button>
                    </div>
                </div>
            </header>

            {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
            <main className="max-w-2xl mx-auto px-4 py-6 space-y-6">
                {/* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}
                {error && (
                    <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                        <p className="text-red-600 text-sm">{error}</p>
                    </div>
                )}

                {/* ãƒ„ã‚¤ãƒ¼ãƒˆä½œæˆ */}
                <TweetComposer
                    onTweetCreated={handleTweetCreated}
                    onCreateTweet={handleCreateTweet}
                />

                {/* ãƒ„ã‚¤ãƒ¼ãƒˆä¸€è¦§ */}
                <TweetList
                    tweets={tweets}
                    username={userInfo?.username || ""}
                    isLoading={isLoading}
                    isRefreshing={isRefreshing}
                    onRefresh={handleRefresh}
                    onDelete={handleDeleteTweet}
                    deletingTweetId={deletingTweetId}
                />
            </main>
        </div>
    );
}
```

**è¿½åŠ ã—ãŸæ©Ÿèƒ½ï¼š**

#### ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿
```typescript
const handleCreateTweet = async (text: string) => {
    if (!session) {
        throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");
    }

    await createTweet(text);
};

const handleTweetCreated = () => {
    handleRefresh();  // æŠ•ç¨¿å¾Œã€ç”»é¢ã‚’æ›´æ–°
};
```

#### ãƒ„ã‚¤ãƒ¼ãƒˆå‰Šé™¤
```typescript
const handleDeleteTweet = async (tweetId: string) => {
    if (!session) return;

    setDeletingTweetId(tweetId);
    try {
        await deleteTweet(tweetId);

        // ãƒ­ãƒ¼ã‚«ãƒ«ã®çŠ¶æ…‹ã‹ã‚‰å‰Šé™¤ï¼ˆå³åº§ã«ç”»é¢ã‹ã‚‰æ¶ˆãˆã‚‹ï¼‰
        setTweets((prev) => prev.filter((t) => t.id !== tweetId));
        setError(null);
    } catch (err) {
        console.error("Failed to delete tweet:", err);
        setError("æŠ•ç¨¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ");
    } finally {
        setDeletingTweetId(undefined);
    }
};
```

**æ¥½è¦³çš„UIæ›´æ–°ï¼š**

å‰Šé™¤APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾…ãŸãšã«ã€ç”»é¢ã‹ã‚‰ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æ¶ˆã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã™ãã«å¤‰åŒ–ã‚’æ„Ÿã˜ã‚‰ã‚Œã¾ã™ã€‚

---

## 6. å‹•ä½œç¢ºèª

### 6-1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š
```bash
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§`http://localhost:3000`ã‚’é–‹ãã¾ã™ã€‚

### 6-2. ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã—ã¦ã¿ã‚‹

**æ‰‹é †ï¼š**

1. ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã€Œãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã€ã¨å…¥åŠ›
2. æ®‹ã‚Šæ–‡å­—æ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆ270 / 280ï¼‰
3. ã€ŒæŠ•ç¨¿ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
5. ã€ŒæŠ•ç¨¿ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
6. **ç”»é¢ãŒæ›´æ–°ã•ã‚Œã€æ–°ã—ã„ãƒ„ã‚¤ãƒ¼ãƒˆãŒä¸€ç•ªä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼**

**æˆåŠŸã§ã™ï¼**

### 6-3. ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¦ã¿ã‚‹

**æ‰‹é †ï¼š**

1. ãƒ„ã‚¤ãƒ¼ãƒˆã®å³ä¸Šã«ã‚ã‚‹ã€ŒğŸ—‘ï¸ å‰Šé™¤ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. **å³åº§ã«ç”»é¢ã‹ã‚‰ãƒ„ã‚¤ãƒ¼ãƒˆãŒæ¶ˆãˆã‚‹ï¼**

**ã“ã‚Œã§å®Œæˆã§ã™ï¼**

---

## 7. ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•

### ã‚¨ãƒ©ãƒ¼1: 403 Forbiddenï¼ˆãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿æ™‚ï¼‰

**ç—‡çŠ¶ï¼š**

ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿æ™‚ã«ã€ŒFailed to create tweetã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚

**åŸå› ï¼š**

`tweet.write`ã‚¹ã‚³ãƒ¼ãƒ—ãŒå«ã¾ã‚Œã¦ã„ãªã„ã€‚

**è§£æ±ºæ–¹æ³•ï¼š**

1. `lib/auth.ts`ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ç¢ºèªï¼š
```typescript
   scope: "users.read tweet.read tweet.write offline.access"
```

2. `tweet.write`ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

3. Twitter Developer Portalã§ã€ŒApp permissionsã€ãŒã€ŒRead and Writeã€ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª

4. **ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆã—ã¦å†ã‚µã‚¤ãƒ³ã‚¤ãƒ³**ï¼ˆé‡è¦ï¼ï¼‰

**ãƒ‡ãƒãƒƒã‚°æ–¹æ³•ï¼š**

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ãƒ­ã‚°ã§ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ç¢ºèªï¼š
```
[auth][debug] token: {
  scope: "users.read tweet.read tweet.write offline.access"
}
```

`tweet.write`ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆã€ã“ã‚ŒãŒåŸå› ã§ã™ã€‚

### ã‚¨ãƒ©ãƒ¼2: ã€ŒTweet text is requiredã€

**ç—‡çŠ¶ï¼š**

ç©ºã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚

**åŸå› ï¼š**

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£ã—ãæ©Ÿèƒ½ã—ã¦ã„ã‚‹ï¼ˆã“ã‚Œã¯æ­£å¸¸ãªå‹•ä½œã§ã™ï¼‰ã€‚

**è§£æ±ºæ–¹æ³•ï¼š**

ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ã‹ã‚‰æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚

### ã‚¨ãƒ©ãƒ¼3: å‰Šé™¤ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„

**ç—‡çŠ¶ï¼š**

ãƒ„ã‚¤ãƒ¼ãƒˆã«å‰Šé™¤ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€‚

**åŸå› ï¼š**

`TweetList`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«`onDelete`ãƒ—ãƒ­ãƒƒãƒ—ãŒæ¸¡ã•ã‚Œã¦ã„ãªã„ã€‚

**è§£æ±ºæ–¹æ³•ï¼š**

`app/page.tsx`ã‚’ç¢ºèªï¼š
```typescript
<TweetList
    tweets={tweets}
    username={userInfo?.username || ""}
    isLoading={isLoading}
    isRefreshing={isRefreshing}
    onRefresh={handleRefresh}
    onDelete={handleDeleteTweet}  // â† ã“ã‚ŒãŒå¿…è¦
    deletingTweetId={deletingTweetId}
/>
```

### ã‚¨ãƒ©ãƒ¼4: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„

**ç—‡çŠ¶ï¼š**

ã€ŒæŠ•ç¨¿ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€‚

**åŸå› ï¼š**

`TweetPreview`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã€‚

**è§£æ±ºæ–¹æ³•ï¼š**

`components/TweetComposer.tsx`ã®å†’é ­ã‚’ç¢ºèªï¼š
```typescript
import TweetPreview from "./TweetPreview";
```

### ã‚¨ãƒ©ãƒ¼5: æŠ•ç¨¿å¾Œã«ç”»é¢ãŒæ›´æ–°ã•ã‚Œãªã„

**ç—‡çŠ¶ï¼š**

ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿ã—ã¦ã‚‚ã€ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œãªã„ã€‚

**åŸå› ï¼š**

`handleTweetCreated`ã§`handleRefresh`ãŒå‘¼ã°ã‚Œã¦ã„ãªã„ã€‚

**è§£æ±ºæ–¹æ³•ï¼š**

`app/page.tsx`ã‚’ç¢ºèªï¼š
```typescript
const handleTweetCreated = () => {
    handleRefresh();  // â† ã“ã‚ŒãŒå¿…è¦
};
```

---

## 8. ã•ã‚‰ã«æ”¹å–„ã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢

### 8-1. å®Ÿè£…ã§ãã‚‹è¿½åŠ æ©Ÿèƒ½

ã“ã®ã‚¢ãƒ—ãƒªã‚’ã•ã‚‰ã«æ”¹å–„ã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ï¼š

| æ©Ÿèƒ½ | èª¬æ˜ | é›£æ˜“åº¦ |
|-----|------|-------|
| ç”»åƒä»˜ããƒ„ã‚¤ãƒ¼ãƒˆ | Twitter APIã®ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ä½¿ç”¨ | é«˜ |
| ã‚¹ãƒ¬ãƒƒãƒ‰æ©Ÿèƒ½ | è¤‡æ•°ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’é€£ç¶šæŠ•ç¨¿ | ä¸­ |
| ä¸‹æ›¸ãä¿å­˜ | ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¸‹æ›¸ãã‚’ä¿å­˜ | ä½ |
| ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ | Tailwind CSSã®ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’å®Ÿè£… | ä½ |
| ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ | ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ„ã‚¤ãƒ¼ãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ | ä¸­ |
| äºˆç´„æŠ•ç¨¿ | æŒ‡å®šæ™‚åˆ»ã«è‡ªå‹•æŠ•ç¨¿ | é«˜ |
| ãƒ„ã‚¤ãƒ¼ãƒˆç·¨é›† | Twitter APIã®ãƒ„ã‚¤ãƒ¼ãƒˆç·¨é›†æ©Ÿèƒ½ã‚’ä½¿ç”¨ | ä¸­ |
| ãƒªãƒ„ã‚¤ãƒ¼ãƒˆæ©Ÿèƒ½ | è‡ªåˆ†ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’ãƒªãƒ„ã‚¤ãƒ¼ãƒˆ | ä¸­ |

### 8-2. æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

Vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ‰‹é †ï¼š

1. GitHubã«ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆ
2. ã‚³ãƒ¼ãƒ‰ã‚’ãƒ—ãƒƒã‚·ãƒ¥
3. [Vercel](https://vercel.com/)ã«ãƒ­ã‚°ã‚¤ãƒ³
4. ã€ŒNew Projectã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ
6. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼š
   - `TWITTER_CLIENT_ID`
   - `TWITTER_CLIENT_SECRET`
   - `NEXTAUTH_URL`ï¼ˆæœ¬ç•ªURLï¼‰
   - `NEXTAUTH_SECRET`
7. ãƒ‡ãƒ—ãƒ­ã‚¤

**Twitter Developer Portalã®è¨­å®šã‚‚å¿˜ã‚Œãšã«ï¼š**

- Callback URLã‚’æœ¬ç•ªURLã«å¤‰æ›´ï¼ˆä¾‹ï¼š`https://your-app.vercel.app/api/auth/callback/twitter`ï¼‰
- Website URLã‚’æœ¬ç•ªURLã«å¤‰æ›´

---

## ã¾ã¨ã‚

### ã“ã®ã‚·ãƒªãƒ¼ã‚ºã§å­¦ã‚“ã ã“ã¨

#### ç¬¬1éƒ¨ï¼šèªè¨¼ç·¨

âœ… Twitter APIã¨ã¯ä½•ã‹  
âœ… OAuthèªè¨¼ã®ä»•çµ„ã¿  
âœ… NextAuth.jsã§ã®èªè¨¼å®Ÿè£…  
âœ… ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

#### ç¬¬2éƒ¨ï¼šãƒ„ã‚¤ãƒ¼ãƒˆè¡¨ç¤ºç·¨

âœ… Twitter APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹æ–¹æ³•  
âœ… APIãƒ«ãƒ¼ãƒˆã®ä½œæˆ  
âœ… UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ  
âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### ç¬¬3éƒ¨ï¼šæŠ•ç¨¿ãƒ»å‰Šé™¤ç·¨

âœ… ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿APIã®å®Ÿè£…  
âœ… ãƒ„ã‚¤ãƒ¼ãƒˆå‰Šé™¤APIã®å®Ÿè£…  
âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³  
âœ… ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½  
âœ… æ¥½è¦³çš„UIæ›´æ–°  
âœ… 403 Forbiddenã‚¨ãƒ©ãƒ¼ã®è§£æ±º

### å®Œæˆã—ãŸã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½

âœ… Xï¼ˆTwitterï¼‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³  
âœ… è‡ªåˆ†ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’è¡¨ç¤º  
âœ… æ–°ã—ã„ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æŠ•ç¨¿  
âœ… ãƒ„ã‚¤ãƒ¼ãƒˆã‚’å‰Šé™¤  
âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç”»é¢ãŒæ›´æ–°ã•ã‚Œã‚‹  
âœ… æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ  
âœ… ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½

**ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼å®Œæˆã§ã™ï¼ğŸ‰**

---

## å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Twitter API v2 - Manage Tweets](https://developer.twitter.com/en/docs/twitter-api/tweets/manage-tweets/introduction) - ãƒ„ã‚¤ãƒ¼ãƒˆæŠ•ç¨¿ãƒ»å‰Šé™¤
- [Twitter API v2 - Rate Limits](https://developer.twitter.com/en/docs/twitter-api/rate-limits) - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®è©³ç´°
- [NextAuth.js - Callbacks](https://next-auth.js.org/configuration/callbacks) - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®ä½¿ã„æ–¹

### Reacté–¢é€£

- [ReactçŠ¶æ…‹ç®¡ç†ã‚¬ã‚¤ãƒ‰](https://react.dev/learn/managing-state) - useStateã€useEffectã®ä½¿ã„æ–¹
- [Reactã®ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†](https://react.dev/learn/reacting-to-input-with-state) - ãƒ•ã‚©ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç†

### UI/UXé–¢é€£

- [Tailwind CSSå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://tailwindcss.com/docs) - CSSãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- [æ¥½è¦³çš„UIæ›´æ–°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](https://www.patterns.dev/posts/optimistic-ui) - UXã‚’å‘ä¸Šã•ã›ã‚‹æ‰‹æ³•

### ãƒ‡ãƒ—ãƒ­ã‚¤é–¢é€£

- [Vercelå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://vercel.com/docs) - ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•
- [Next.jsã®ç’°å¢ƒå¤‰æ•°è¨­å®š](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables) - æœ¬ç•ªç’°å¢ƒã§ã®ç’°å¢ƒå¤‰æ•°

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

- [Twitter API ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§](https://developer.twitter.com/en/support/twitter-api/error-troubleshooting) - ã‚¨ãƒ©ãƒ¼ã®æ„å‘³
- [OAuth 2.0ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](https://developer.twitter.com/en/docs/authentication/oauth-2-0/authorization-code) - èªè¨¼ã‚¨ãƒ©ãƒ¼ã®è§£æ±º

### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£

- [Twitter API Developers Community](https://twittercommunity.com/) - è³ªå•ã§ãã‚‹ãƒ•ã‚©ãƒ¼ãƒ©ãƒ 
- [Next.js Discord](https://nextjs.org/discord) - Next.jsã®å…¬å¼Discord
- [Stack Overflow](https://stackoverflow.com/questions/tagged/twitter-api-v2) - Twitter API v2ã®ã‚¿ã‚°

---

## æœ€å¾Œã«

3éƒ¨ä½œã‚’é€šã—ã¦ã€Next.jsã¨Twitter API v2ã‚’ä½¿ã£ãŸå®Œå…¨ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**

1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**ï¼šã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã®ã¿ä½¿ç”¨
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**ï¼šè©³ç´°ãªãƒ­ã‚°ã§ãƒ‡ãƒãƒƒã‚°ã‚’å®¹æ˜“ã«
3. **UX**ï¼šãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€æ¥½è¦³çš„UIæ›´æ–°
4. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**ï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¨ã‚µãƒ¼ãƒãƒ¼å´ã®ä¸¡æ–¹ã§æ¤œè¨¼

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼š**

- æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
- è¿½åŠ æ©Ÿèƒ½ã®å®Ÿè£…ï¼ˆç”»åƒæŠ•ç¨¿ã€ã‚¹ãƒ¬ãƒƒãƒ‰ã€ä¸‹æ›¸ããªã©ï¼‰
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

**ã“ã®ã‚¢ãƒ—ãƒªã‚’è‡ªåˆ†å¥½ã¿ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã€æ¥½ã—ã‚“ã§ãã ã•ã„ï¼**

è³ªå•ãŒã‚ã‚Œã°ã€Twitter APIã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„Stack Overflowã§èã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

Happy Coding! ğŸš€